:title: Observability in Keycloak 26.2
:date: 2025-04-23
:publish: true
:author: Michal Hajas
:summary: Observability improved a lot in Keycloak's latest release. Learn what changed in this post and in our online meetup on 7th May 2025.

When running a central single sign on service like Keycloak in production, it is essential to understand how well the system performs and whether there are service degradations.
Having a proper monitoring stack in place is essential for this.
Moreover, when the system performance degrades, it is crucial to identify which part of the system is causing the problem to be able to address it.

In the latest Keycloak release, all of the above became more straightforward and works out of the box without the need to deploy additional extensions.

== Hey Keycloak! How are you?

// Adding this paragraph to make it more specific and connect it to some real world needs
Users rely on Keycloak to log in to their applications, and the key metrics capturing that behavior are defined as service level indicators (SLIs).
Misbehavior of the system can be detected by monitoring these SLIs.

// I don't agree that an indicator represents "an aspect of the system", rather "an aspect of the observed behavior by the users". Given the sentence above, the sentence might be redundant, so I commented it out
// Each indicator represents some aspect of the system that plays an important role in determining whether the system is performing well.

// TODO: While the availability is one of the SLIs, it doesn't use metrics that are provided by Keycloak, so I'd rather use a different example, like latency
One of the indicators can be the availability of the system.
The indicator for availability can be defined as: percentage of the time the system is able to answer requests.
The lower the indicator is for your system, the less available it was in the observed period.

An example set of SLIs for Keycloak and more details on this topic can be found in the https://www.keycloak.org/observability/keycloak-service-level-indicators[Monitoring performance with Service Level Indicators] guide.

== Oh no! You are not doing well?

Now we know how to detect when Keycloak is not performing well.
But what should I do when a service level indicator shows a degradation of the service?
This situation usually means some part of Keycloak does not perform well, however, from the indicator itself, it is hard to say what part of Keycloak it is.

To identify the culprit of the problem, we provide the https://www.keycloak.org/observability/metrics-for-troubleshooting[Troubleshooting using metrics] guide that lists chosen metrics.
Using these metrics, you can visualize what is happening in your deployment and down problems.

Some examples of metrics from the guide are listed below:

* Number of operations performed by Keycloak like password hashes, login flows, token refreshes, etc.
* Memory usage
* Database connection pool utilization
* Number of HTTP requests per URL and outcome
* Hit ratios for internal caches

For environments with Prometheus for collecting metrics and Grafana for displaying them, we also provide Grafana dashboards to make troubleshooting smoother.
Instructions on how to deploy our dashboards into your Grafana instance can be found in the https://www.keycloak.org/observability/grafana-dashboards[Visualizing activities in dashboards] guide.

--
++++
<div class="paragraph">
<a href="${blogImages}/grafana-dashboards-2025.png"><img src="${blogImages}/grafana-dashboards-2025.png" alt="Grafana dashboards with SLIs, password validations, database connections pool and http metrics." style="width: 100%; max-width: 1049px; height: auto; aspect-ratio: 1049 / 1269;"></a>
</div>
++++
--

== My Keycloak is still sick :( I need an in-depth examination

Thanks to metrics, you can observe certain aspects of the system and how they evolve over time.
However, they may not provide a detailed picture of what is happening inside Keycloak for a specific request.
For this, you can leverage traces.
Learn more in the https://www.keycloak.org/observability/tracing[Root cause analysis with tracing] guide.

With tracing, you can observe steps that Keycloak was performing for a specific request including the respective timing for each of them.
These steps include operations done by Keycloak but also waiting time for responses from third party services like the database, LDAP, Infinispan and others.
This helps you to reveal where the bottleneck in your system is.

In the example below, you can see steps Keycloak was performing when the username and password form was submitted.
You can see the most time-consuming step was password hashing, which took 30 milliseconds out of 48-millisecond total request processing time.
--
++++
<div class="paragraph">
<a href="${blogImages}/tracing-2025.png"><img src="${blogImages}/tracing-2025.png" alt="Trace displayed in Jaeger for username password form submission." style="width: 100%; max-width: 2202px; height: auto; aspect-ratio: 2202 / 957;"></a>
</div>
++++
--

== Next steps

To see all of this in action and to ask live questions, join the Keycloak hour of code online meetup held on 7th May 2025 at 4pm CEST dedicated to observability.

As an appetizer, see a shorter version of https://youtu.be/bC4xbBJs0CA?si=WfptsITHZvpYBM_8&t=769[a demo by Ryan Emerson recorded at KubeCon London 2025].

To ask questions outside the meetup, use the https://cloud-native.slack.com/channels/keycloak-sre-sig[CNCF #keycloak-sre-sig Slack channel].
Use https://slack.cncf.io/ to join the CNCF Slack if you do not have an account yet.

// TODO: Do you want to direct people to an existing discussion, or create a discussion just for this blog post? Otherwise we might not monitor that discussion
You can also create a new discussion thread in the https://github.com/keycloak/keycloak/discussions[Keycloak Github repository].
